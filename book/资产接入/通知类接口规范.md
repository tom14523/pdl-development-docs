# 通知类接口开发规范

## 通知接口的约定

* 海投汇通过HTTP协议POST方式，以 `application/x-www-form-urlencoded` 的方式提交数据，调用商户的通知接收接口。
* 所有的API请求和响应数据编码皆为`UTF-8`格式（切勿转成`unicode`编码），对于含有中文字符的消息报文，URL 里的参数值在发送请求时需要`URLEncoder`，接收请求时需做`URLDecoder`处理。
* 商户方的接口性能要求：接口超时时间10秒。推荐商家在接收到消息且进行基础校验后，后续逻辑采用异步方式处理。
* 由于网络原因、接口响应超时或要求业务重试，平台会自动重新推送通知：重试最大有效期为8小时，每次重试间隔最大为5分钟，8小时内间隔性重试，要求接口具备消息排重能力。

## 商户接收通知的接口配置

* 每个接口地址，目前暂时由海投汇技术来配置。

## 调用参数

> 商户开发通知接收接口，须严格按照开放平台签名规则开发，以下签名示例，仅供参考。

调用商户的通知接口时，必须传入`公共参数`和对应的`通知参数`。各个接口的`通知参数`，详见API文档。

### 1. 公共参数

| 字段名    | 字段描述     | 类型   | 最大长度 | 必填 | 备注                                                                                               |
| --------- | ------------ | ------ | -------- | ---- | -------------------------------------------------------------------------------------------------- |
| version   | 接口版本号   | String | 5        | 是   | 目前为1.0                                                                                          |
| app_id    | 应用的app_id | String | 8        | 是   |                                                                                                    |
| timestamp | 时间戳       | String | 19       | 是   | 格式为yyyy-MM-dd HH:mm:ss，例如：2011-06-16 13:23:30 |
| sign      | 签名         | String |          | 是   | -                                                                                                   |

### 2. 通知参数

| 字段名    | 字段描述     | 类型   | 最大长度 | 必填 | 备注                                                                                               |
| --------- | ------------ | ------ | -------- | ---- | -------------------------------------------------------------------------------------------------- |
| data      | 通知参数      | String |          | 是   | Json String                                                                                         |

## 响应结果

* 接口返回结果格式只支持Json格式
* 不需要签名

| 字段名      | 字段描述     | 类型   | 最大长度 | 必填 | 备注                                                                                            |
|-------------|--------------|--------|----------|------|-------------------------------------------------------------------------------------------------|
| ret_code    | 响应状态码    | int |          | 是   |                                                                                                 |
| ret_message | 响应描述     | String |          | 是   | -                                                                                                |

```json
{
    "ret_code":20000,
    "ret_message":"OK"
}
```

## 参数签名

与[海投汇接口规范](海投汇接口规范.md)中的签名规则一样

## 错误码

商户可以使用以下错误码来响应海投汇的通知调用

| 错误码 | 描述                |
|--------|---------------------|
| 20000  | 操作成功            |
| -1     | 操作失败，不需要重试 |
| -10000 | 操作失败，需要重试   |
| 10005  | 必填项参数未填      |
| 10014  | 无效sign签名        |
| 10015  | 参数异常            |